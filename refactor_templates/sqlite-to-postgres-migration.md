# Шаблон промпта для рефакторинга: Миграция с SQLite на PostgreSQL (Node.js + Express)

## Оптимальный промпт для AI-ассистента

```
Ты опытный разработчик Node.js. Твоя задача - помочь в миграции проекта с SQLite на PostgreSQL.

## Контекст проекта:
- Стек: Node.js + Express
- Текущая БД: SQLite
- Целевая БД: PostgreSQL
- ORM/Библиотека: [указать текущую библиотеку, например: sqlite3]

## Требования к миграции:

### 1. Анализ текущей архитектуры:
- Проанализируй существующие файлы подключения к БД
- Определи все места, где используется SQLite
- Выяви зависимости и конфигурации
- Составь список всех SQL-запросов и операций

### 2. Подготовка инфраструктуры:
- Обнови package.json: добавь pg (или соответствующий PostgreSQL драйвер)
- Создай/обнови конфигурационные файлы для PostgreSQL
- Настрой переменные окружения (DATABASE_URL, DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASS)
- Создай скрипты миграции базы данных

### 3. Рефакторинг кода:

#### Подключение к БД:
- Замени sqlite3 на pg (или другой PostgreSQL драйвер)
- Обнови строку подключения
- Настрой параметры соединения (пулы соединений, таймауты)
- Добавь обработку ошибок подключения

#### SQL-запросы:
- Конвертируй SQLite-специфичные запросы в PostgreSQL-совместимые:
  * AUTOINCREMENT → SERIAL
  * INTEGER PRIMARY KEY → SERIAL PRIMARY KEY
  * DATE функции → соответствующие PostgreSQL функции
  * LIMIT/OFFSET синтаксис
  * Специфичные типы данных

#### Транзакции:
- Обнови синтаксис транзакций под PostgreSQL
- Проверь блокировки и изоляцию
- Настрой управление соединениями

#### Миграции:
- Создай скрипты переноса данных
- Обеспечь целостность данных
- Добавь валидацию после миграции

### 4. Тестирование:
- Проверь все CRUD операции
- Протестируй сложные запросы и JOIN'ы
- Убедись в корректной работе транзакций
- Проверь производительность запросов

### 5. Документация:
- Обнови README с новыми инструкциями по настройке
- Добавь раздел о различиях между SQLite и PostgreSQL
- Укажи особенности конфигурации

## Важные моменты:
- Сохрани все существующие функции и API
- Обеспечь обратную совместимость где возможно
- Добавь логирование для отладки
- Проверь права доступа к БД
- Убедись в безопасности SQL-запросов (защита от инъекций)

## Файлы для анализа:
[Перечислить ключевые файлы, которые нужно проанализировать]

## Примеры кода:
[Приложить примеры текущего кода для рефакторинга]

Выполни рефакторинг поэтапно, объясняя каждый шаг. Предоставь готовое решение с пояснениями.
```

## Дополнительные рекомендации:

### Для Sequelize:
```
- Обнови dialect с 'sqlite' на 'postgres'
- Настрой параметры host, port, username, password, database
- Проверь типы данных в моделях
- Обнови миграции под PostgreSQL
```

### Для Knex.js:
```
- Измени client с 'sqlite3' на 'pg'
- Обнови connection параметры
- Проверь синтаксис запросов
- Обнови seeds и миграции
```

### Для нативного sqlite3:
```
- Замени sqlite3 на pg
- Перепиши все методы (run, get, all, exec)
- Обнови обработку результатов
- Настрой пулы соединений
```

## Чек-лист миграции:
- [ ] Обновление зависимостей
- [ ] Настройка конфигурации
- [ ] Рефакторинг подключения
- [ ] Конвертация SQL-запросов
- [ ] Обновление миграций
- [ ] Тестирование функциональности
- [ ] Проверка производительности
- [ ] Обновление документации
